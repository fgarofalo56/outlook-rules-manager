# Gitleaks Configuration for Outlook Rules Manager
# Prevents committing credentials, secrets, tenant info, and personal data

title = "Outlook Rules Manager - Security Scanning"

[extend]
# Extend the default gitleaks rules
useDefault = true

# ===========================================
# CUSTOM RULES - Azure/Microsoft Specific
# ===========================================

[[rules]]
id = "azure-tenant-id"
description = "Azure Tenant ID (GUID format)"
regex = '''(?i)(tenant[-_]?id|tenantid)\s*[=:]\s*["']?([a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12})["']?'''
tags = ["azure", "tenant", "pii"]

[[rules]]
id = "azure-client-id"
description = "Azure Client/Application ID (GUID format)"
regex = '''(?i)(client[-_]?id|clientid|app[-_]?id|application[-_]?id)\s*[=:]\s*["']?([a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12})["']?'''
tags = ["azure", "credentials"]

[[rules]]
id = "azure-client-secret"
description = "Azure Client Secret"
regex = '''(?i)(client[-_]?secret|clientsecret)\s*[=:]\s*["']?[A-Za-z0-9~._-]{30,}["']?'''
tags = ["azure", "secret", "credentials"]

[[rules]]
id = "azure-subscription-id"
description = "Azure Subscription ID (GUID format)"
regex = '''(?i)(subscription[-_]?id|subscriptionid)\s*[=:]\s*["']?([a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12})["']?'''
tags = ["azure", "subscription"]

# ===========================================
# CUSTOM RULES - Personal Information (PII)
# ===========================================

[[rules]]
id = "email-address"
description = "Email address (potential PII)"
regex = '''[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.(com|org|net|edu|gov|mil|io|co|us|uk|ca|au|de|fr|microsoft\.com)'''
tags = ["pii", "email"]
# Allow example emails (RFC 2606 reserved domains and common placeholders)
[rules.allowlist]
regexes = [
    '''@example\.(com|org|net)''',
    '''@domain\.(com|org|net)''',
    '''@company\.com''',
    '''@contoso\.com''',
    '''@fabrikam\.com''',
    '''@test\.(com|org|net)''',
    '''@localhost''',
    '''user@''',
    '''test@''',
    '''admin@''',
    '''backup@''',
    '''spam@''',
    '''noreply@''',
    '''placeholder''',
    '''YOUR_''',
    '''<.*@.*>''',
]

[[rules]]
id = "microsoft-alias"
description = "Microsoft employee alias pattern"
regex = '''[a-z]{2,}@microsoft\.com'''
tags = ["pii", "microsoft", "email"]

# ===========================================
# CUSTOM RULES - API Keys & Tokens
# ===========================================

[[rules]]
id = "bearer-token"
description = "Bearer Token"
regex = '''(?i)bearer\s+[a-zA-Z0-9_\-\.=]+'''
tags = ["token", "credentials"]

[[rules]]
id = "oauth-token"
description = "OAuth Access Token"
regex = '''(?i)(access[-_]?token|oauth[-_]?token)\s*[=:]\s*["']?[A-Za-z0-9_\-\.]{20,}["']?'''
tags = ["oauth", "token", "credentials"]

# ===========================================
# GLOBAL ALLOWLIST
# ===========================================

[allowlist]
description = "Global allowlist for false positives"
paths = [
    '''\.env\.example$''',
    '''rules-config\.example\.json$''',
    '''\.gitleaks\.toml$''',
    '''\.md$''',  # Documentation files
    '''\.github/.*\.yml$''',  # GitHub workflows (contain example patterns)
    '''examples/.*''',  # Example files directory
    '''tests/.*\.ps1$''',  # Test files (contain example/mock data)
]
regexes = [
    # RFC 2606 reserved example domains
    '''@example\.(com|org|net)''',
    '''@domain\.(com|org|net)''',
    '''example\.com''',
    '''domain\.com''',
    # Microsoft documentation placeholders
    '''@contoso\.com''',
    '''@fabrikam\.com''',
    '''contoso\.com''',
    '''fabrikam\.com''',
    # Common example patterns in help text
    '''user@example''',
    '''backup@example''',
    '''spam@example''',
    '''test@example''',
    '''admin@example''',
    '''list@example''',
    # Placeholder patterns
    '''YOUR_.*''',
    '''\[INSERT.*\]''',
    '''<your-.*>''',
    '''<.*@.*>''',
    # Placeholder GUID
    '''00000000-0000-0000-0000-000000000000''',
]
